<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catch Squares Remote</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #282c34;
            color: white;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        #game-display {
            width: 320px; /* Typical phone width for example */
            height: 240px; /* Typical phone height for example */
            background-color: #000;
            border: 2px solid #5f6b7a;
            position: relative;
            margin-bottom: 20px;
            overflow: hidden; /* Ensure squares don't go out of bounds */
        }
        #paddle {
            position: absolute;
            bottom: 10px;
            width: 80px;
            height: 15px;
            background-color: #007bff;
            left: 50%;
            transform: translateX(-50%);
        }
        .square {
            position: absolute;
            width: 25px;
            height: 25px;
            background-color: #28a745;
        }
        .controls button {
            padding: 15px 30px;
            font-size: 1.2em;
            margin: 10px;
            cursor: pointer;
            background-color: #61afef;
            color: white;
            border: none;
            border-radius: 8px;
            transition: background-color 0.3s ease;
        }
        .controls button:active {
            background-color: #4b89d4;
        }
        #status {
            margin-top: 15px;
            font-size: 0.9em;
            color: #ccc;
        }
        #game-info {
            display: flex;
            justify-content: space-around;
            width: 100%;
            max-width: 320px;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
    </style>
</head>
<body>
<h1>Catch Squares Remote</h1>

<div id="game-info">
    <span>Score: <span id="score">0</span></span>
    <span>Lives: <span id="lives">3</span></span>
</div>

<div id="game-display">
    <div id="paddle"></div>
    <div id="squares-container"></div>
</div>

<div class="controls">
    <button id="leftButton">Left</button>
    <button id="rightButton">Right</button>
</div>

<div id="status">Connecting...</div>

<script>
    // !!! IMPORTANT: Replace with the actual public IP/domain and port of your Python server !!!
    // Example: If your Python server runs on your home PC with public IP 192.168.1.100 and port 5000:
    // const WS_SERVER_URL = 'ws://192.168.1.100:5000';
    // If deployed to a cloud server:
    // const WS_SERVER_URL = 'wss://your-cloud-server.com/ws'; // Use wss for HTTPS
    const WS_SERVER_URL = 'ws://localhost:5000/ws'; // For local testing, assuming Python server runs on 5000

    let socket;
    const statusDiv = document.getElementById('status');
    const scoreSpan = document.getElementById('score');
    const livesSpan = document.getElementById('lives');
    const paddleElement = document.getElementById('paddle');
    const squaresContainer = document.getElementById('squares-container');

    const GAME_DISPLAY_WIDTH = 320; // Must match CSS and server's assumed game width
    const GAME_DISPLAY_HEIGHT = 240; // Must match CSS and server's assumed game height

    function connectWebSocket() {
        if (socket && socket.readyState === WebSocket.OPEN) {
            return; // Already connected
        }
        socket = new WebSocket(WS_SERVER_URL);

        socket.onopen = (event) => {
            statusDiv.textContent = 'Connected to game server.';
            console.log('WebSocket opened:', event);
        };

        socket.onmessage = (event) => {
            const gameState = JSON.parse(event.data);
            updateGameDisplay(gameState);
        };

        socket.onclose = (event) => {
            statusDiv.textContent = `Disconnected. Code: ${event.code}, Reason: ${event.reason}. Retrying...`;
            console.log('WebSocket closed:', event);
            setTimeout(connectWebSocket, 3000); // Attempt to reconnect after 3 seconds
        };

        socket.onerror = (error) => {
            statusDiv.textContent = 'Connection error. Retrying...';
            console.error('WebSocket error:', error);
            socket.close(); // Force close to trigger onclose and retry
        };
    }

    function sendControl(direction) {
        if (socket && socket.readyState === WebSocket.OPEN) {
            socket.send(JSON.stringify({ type: 'control', direction: direction }));
        } else {
            console.warn('WebSocket not open. Cannot send control:', direction);
            statusDiv.textContent = 'Not connected. Trying to reconnect...';
        }
    }

    function updateGameDisplay(gameState) {
        scoreSpan.textContent = gameState.score;
        livesSpan.textContent = gameState.lives;

        // Update paddle position (scale server's coordinates to client's display)
        // Assuming server_paddle_x is 0-SCREEN_WIDTH and client_paddle_x is 0-GAME_DISPLAY_WIDTH
        const scaledPaddleX = (gameState.paddle_x / 800) * GAME_DISPLAY_WIDTH;
        paddleElement.style.left = `${scaledPaddleX}px`;

        // Clear old squares
        squaresContainer.innerHTML = '';
        // Add new squares
        gameState.squares.forEach(sq => {
            const squareDiv = document.createElement('div');
            squareDiv.className = 'square';
            const scaledSquareX = (sq.x / 800) * GAME_DISPLAY_WIDTH;
            const scaledSquareY = (sq.y / 600) * GAME_DISPLAY_HEIGHT;
            squareDiv.style.left = `${scaledSquareX}px`;
            squareDiv.style.top = `${scaledSquareY}px`;
            squaresContainer.appendChild(squareDiv);
        });

        if (gameState.game_over) {
            statusDiv.textContent = 'GAME OVER! Refresh to play again.';
        }
    }

    document.getElementById('leftButton').addEventListener('mousedown', () => sendControl('left'));
    document.getElementById('rightButton').addEventListener('mousedown', () => sendControl('right'));
    // For touch devices
    document.getElementById('leftButton').addEventListener('touchstart', (e) => { e.preventDefault(); sendControl('left'); });
    document.getElementById('rightButton').addEventListener('touchstart', (e) => { e.preventDefault(); sendControl('right'); });

    // Initial connection
    connectWebSocket();
</script>
</body>
</html>